syntax = "proto3";

package ordersrv;

import "message.proto";

service OrderService {
    rpc RequestHandler (MessageRequest) returns (MessageResponse);
    rpc SchedulerMessageHandler(MessageRequest) returns (MessageResponse);
    rpc NewOrder (RequestNewOrder) returns (ResponseNewOrder);
}

message Money {
    string Amount = 1;
    string Currency = 2;
}

message ResponseNewOrder {
    string callbackUrl  = 1;
}

message RequestNewOrder {
    Buyer buyer = 1;
    string platform = 2;
    Invoice invoice = 3;
    repeated Package packages = 4;
}

message Package {
    uint64 sellerId = 1;
    string shopName = 2;
    ShippingSpec shipment = 3;
    PackageInvoice invoice = 4;
    repeated Item items = 5;
}

message PackageInvoice {
    Money subtotal = 1;
    Money discount = 2;
    Money shipmentPrice = 3;
}

message Invoice {
    Money  grandTotal      = 1;
    Money  subtotal        = 2;
    Money  discount        = 3;
    Money  shipmentTotal   = 6;
    string  paymentMethod   = 7;
    string  paymentGateway  = 8;
    PaymentOption  paymentOption   = 9;
    Voucher voucher         = 10;
}

message PaymentOption {}

message Voucher {
    float   percent = 1;
    Money   Price   = 2;
    string  code    = 3;
    VoucherDetails details = 4;
}

message VoucherDetails {
    string startDate = 1;
    string endDate = 2;
    string type = 3;
    uint64 maxDiscountValue = 4;
    uint64 minBasketValue = 5;
}

message Item {
    string sku = 1;
    string inventoryId = 2;
    string title = 3;
    string brand = 4;
    string category = 5;
    string guaranty = 6;
    string image = 7;
    bool returnable = 8;
    int32 quantity = 9;
    map<string, string> attributes = 10;
    ItemInvoice invoice = 11;
}

message Buyer {
    uint64 buyerId = 1;
    string firstName = 2;
    string lastName = 3;
    string phone = 4;
    string mobile = 5;
    string email = 6;
    string nationalId = 7;
    string ip = 8;
    string gender = 9;
    FinanceInfo finance = 10;
    Address shippingAddress = 11;
}

message FinanceInfo {
    string iban = 1;
    string cardNumber = 2;
    string accountNumber = 3;
    string bankName = 4;
}

message Address {
    string firstName = 1;
    string lastName = 2;
    string address = 3;
    string phone = 4;
    string mobile = 5;
    string country = 6;
    string city = 7;
    string province = 8;
    string neighbourhood = 9;
    string lat = 10;
    string long = 11;
    string zipCode = 12;
}

message ItemInvoice {
    Money unit = 1;
    Money total = 2;
    Money original = 3;
    Money special = 4;
    Money discount = 5;
    float  sellerCommission = 6;
}

message ShippingSpec {
    repeated string carrierNames = 1;
    string carrierProduct = 2;
    string carrierType = 3;
    Money shippingCost = 4;
    int32 reactionTime = 5;
    int32 shippingTime = 6;
    int32 returnTime = 7;
    string details = 8;
}