version: '3.7'
services:
  order-service:
    image: ${TAG}
    restart: always
    ports:
      - ${PORT}:${PORT}
      - 40010:40010
    security_opt:
      - seccomp:unconfined
    environment:
      - PORT=${PORT}
      - ORDER_SERVICE_MODE=server
      - ORDER_SERVER_ADDRESS=
      - ORDER_SERVER_PORT=9095
      - ORDER_SERVICE_MONGO_HOST=mongo
      - ORDER_SERVICE_MONGO_PORT=27017
      - ORDER_SERVICE_MONGO_USER=root
      - ORDER_SERVICE_MONGO_CONN_TIMEOUT=5
      - ORDER_SERVICE_MONGO_READ_TIMEOUT=5
      - ORDER_SERVICE_MONGO_WRITE_TIMEOUT=5
      - ORDER_SERVICE_MONGO_MAX_CONN_IDLE_TIME=60
      - ORDER_SERVICE_MONGO_MAX_POOL_SIZE=128
      - ORDER_SERVICE_MONGO_MIN_POOL_SIZE=64
      - NOTIFICATION_SMS_TEMPLATES=testdata/notification/sms
      - EMAIL_TMP_NOTIFY_SELLER_FOR_NEW_ORDER=NotifySellerForNewOrder.html
      - PAYMENT_GATEWAY_ADDRESS=
      - PAYMENT_GATEWAY_PORT=3010
      - PAYMENT_SERVICE_MOCK_ENABLED=false
      - STOCK_SERVICE_ADDRESS=
      - STOCK_SERVICE_PORT=9098
      - STOCK_SERVICE_MOCK_ENABLED=false
      - USER_SERVICE_ADDRESS=userservice
      - USER_SERVICE_PORT=9096
      - VOUCHER_SERVICE_ADDRESS=voucherservice
      - VOUCHER_SERVICE_PORT=9097
      - VOUCHER_SERVICE_MOCK_ENABLED=true
    depends_on:
      - mongo

  mongo:
    image: registry.faza.io/mongo:4.0.10
    ports:
      - 27017:27017

  mongo-express:
    image: registry.faza.io/mongo-express:0.49
    ports:
      - 8081:8081
